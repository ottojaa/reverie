
# Plan 03 â€” Client Setup (Web App + Native Android)

## Goal
Set up two separate client applications:
- **Web App**: Electron + React + Vite for desktop and browsers
- **Android App**: Kotlin + Jetpack Compose for android

This phase focuses on:
- Project structure for both clients
- Build tooling
- Shared API contract approach
- Simple landing screens for both platforms with simple navigation between two pages.
- No backend integration yet.

---

## Architecture Decision

### Why Separate Apps?

Instead of React Native + Electron (complex hybrid), we use:
- **Native Android** for best mobile UX (Material You, smooth performance)
- **Electron + Web app** for desktop

### Shared Code Strategy
- OpenAPI spec generated from backend Zod schemas
- Android uses generated Kotlin client (OpenAPI Generator)
- Web imports Zod schemas directly from `shared/` package

---

## Web App

### Technology Stack
- **Framework**: Electron + React 19.2
- **Build**: Vite
- **UI**: Shadcn UI
- **Language**: TypeScript
- **Routing**: TanStack Router
- **Data Fetching**: TanStack Query
- **Styling**: CSS Modules or Tailwind CSS
- **Animations**: Framer Motion (optional) or CSS animations
- **Testing**: Vitest + React Testing Library

### Folder Structure

```
apps/
  web/
    src/
      main.tsx
      App.tsx
      
      pages/
        Landing.tsx
        Upload.tsx
        Browse.tsx
        Search.tsx
        Document.tsx
      
      components/
        common/
          Button.tsx
          Input.tsx
          Modal.tsx
        layout/
          Sidebar.tsx
          Header.tsx
        documents/
          DocumentCard.tsx
          DocumentGrid.tsx
          DocumentPreview.tsx
        upload/
          UploadZone.tsx
          UploadProgress.tsx
      
      hooks/
        useDocuments.ts
        useUpload.ts
        useSearch.ts
        useWebSocket.ts
      
      services/
        api.ts
        websocket.ts
      
      styles/
        globals.css
        variables.css
      
      utils/
    
    index.html
    vite.config.ts
    tsconfig.json
```

### Design Philosophy
- Clean, minimal interface
- Responsive (works on tablets too)
- Keyboard shortcuts for power users
- Drag-and-drop upload
- Grid/list view toggle for documents
- Dark and light mode support (and possibility to extend with multiple other themes)

### Initial Screen: Landing/Dashboard
- Show recent documents
- Quick upload area
- Search bar
- Folder navigation sidebar

---

## Android App

### Technology Stack
- **Language**: Kotlin
- **UI**: Jetpack Compose
- **Architecture**: MVVM + Clean Architecture
- **Design**: Material Design 3 with dynamic color (Material You)
- **Navigation**: Navigation Compose (single Activity)
- **Networking**: Ktor Client or Retrofit
- **Image Loading**: Coil
- **Async**: Kotlin Coroutines + Flow
- **DI**: Hilt
- **Testing**: JUnit + Espresso + Compose Testing

### Folder Structure

```
apps/
  android/
    app/
      src/
        main/
          java/com/reverie/app/
            ReverieApplication.kt
            MainActivity.kt
            
            ui/
              theme/
                Theme.kt
                Color.kt
                Type.kt
              
              screens/
                landing/
                  LandingScreen.kt
                  LandingViewModel.kt
                browse/
                  BrowseScreen.kt
                  BrowseViewModel.kt
                upload/
                  UploadScreen.kt
                  UploadViewModel.kt
                search/
                  SearchScreen.kt
                  SearchViewModel.kt
                document/
                  DocumentScreen.kt
                  DocumentViewModel.kt
              
              components/
                DocumentCard.kt
                DocumentGrid.kt
                SearchBar.kt
                UploadButton.kt
                BlurHashImage.kt
              
              navigation/
                ReverieNavGraph.kt
                Screen.kt
            
            data/
              api/
                ReverieApi.kt
                ApiModels.kt
              repository/
                DocumentRepository.kt
                FolderRepository.kt
              local/
                ReverieDatabase.kt
            
            domain/
              model/
                Document.kt
                Folder.kt
              usecase/
                GetDocumentsUseCase.kt
                UploadDocumentUseCase.kt
            
            di/
              AppModule.kt
              NetworkModule.kt
          
          res/
            values/
              themes.xml
              colors.xml
              strings.xml
        
        build.gradle.kts
      
    build.gradle.kts
    settings.gradle.kts
```

### Design Philosophy (Inspired by Seal)
- Material Design 3 with dynamic color theming
- Single Activity architecture
- Smooth animations and transitions
- Pull-to-refresh patterns
- Bottom sheet for document actions
- FAB for quick upload
- Proper back handling and navigation

### Key UI Components
- **BlurHashImage**: Show blurhash placeholder while loading
- **DocumentCard**: Thumbnail + title + date + category badge
- **UploadProgress**: Real-time progress with WebSocket updates
- **SearchBar**: With filter chips for category/date

### Initial Screen: Landing/Browse
- Grid of recent documents with thumbnails
- Pull-to-refresh
- FAB for upload (camera or gallery)
- Bottom navigation: Browse | Search | Upload | Settings

---

## Shared API Contracts

### OpenAPI Generation
Backend generates OpenAPI spec from Zod schemas:
```bash
# In backend
pnpm run generate:openapi
# Outputs: shared/openapi.json
```

### Web App
Imports Zod schemas directly:
```typescript
import { DocumentSchema, UploadResponseSchema } from '@reverie/shared'
```

### Android App
Uses OpenAPI Generator for Kotlin:
```bash
openapi-generator generate \
  -i ../shared/openapi.json \
  -g kotlin \
  -o app/src/main/java/com/reverie/app/data/api/generated
```

---

## Development Workflow

### Web App
```bash
cd apps/web
pnpm install
pnpm dev          # Start Vite dev server
pnpm build        # Production build
pnpm test         # Run Vitest
```

### Android App
```bash
cd apps/android
./gradlew assembleDebug    # Build debug APK
./gradlew installDebug     # Install on device/emulator
./gradlew test             # Run unit tests
```

---

## Acceptance Criteria

### Web App
- Vite dev server runs successfully
- Landing page renders with basic layout
- TypeScript compilation passes
- Can import types from shared package

### Android App
- App builds and runs on emulator
- Material You theming works
- Landing screen shows with basic UI
- Navigation between screens works

### Both
- No backend dependencies yet (mock data is fine)
- Clean, modern UI appearance
- Responsive to different screen sizes

---

## Future Considerations
- **iOS App**: Can add later using SwiftUI (similar architecture to Android)
- **Desktop App**: Wrap web app in Tauri if native features needed
- **Offline Mode**: Android app could cache documents locally (Room DB)
- **Share Intent**: Android app receives shared images for quick upload



